<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aruna's Kitchen - Weekly Order Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #8B4513; --primary-light: #A0522D; --primary-dark: #6B3410;
            --accent: #D4A574; --accent-light: #E8C9A0;
            --bg-cream: #FDF8F3; --bg-white: #FFFFFF; --bg-warm: #FAF6F1;
            --text-dark: #3D2914; --text-medium: #5D4E37; --text-muted: #8B7355;
            --border-light: #E8DDD0; --border-warm: #D4C4B0;
            --success: #2E7D32; --success-bg: #E8F5E9;
            --warning: #E65100; --warning-bg: #FFF3E0;
            --error: #C62828; --error-bg: #FFEBEE;
        }
        body { font-family: 'Source Sans Pro', sans-serif; background: var(--bg-cream); color: var(--text-dark); line-height: 1.6; }
        .hero { background: linear-gradient(135deg, var(--bg-white), var(--bg-warm)); text-align: center; padding: 1.5rem 1rem; border-bottom: 3px solid var(--accent); }
        .logo-text { font-family: 'Playfair Display', serif; font-size: 2.2rem; font-weight: 700; color: var(--primary); }
        .phone-number { color: var(--text-muted); font-size: 0.95rem; margin-top: 0.25rem; }
        .week-header { margin-top: 0.75rem; }
        .week-label { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: var(--text-dark); font-weight: 600; }
        .week-dates { font-size: 0.9rem; color: var(--primary); margin-top: 0.15rem; font-weight: 500; }
        .cutoff-banner { background: var(--warning-bg); color: var(--warning); padding: 0.5rem 1rem; text-align: center; font-size: 0.85rem; border-bottom: 1px solid #FFCC80; }
        .cutoff-banner strong { color: var(--primary-dark); }
        .container { max-width: 600px; margin: 0 auto; padding: 1rem; }
        .section-card { background: var(--bg-white); border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem; border: 1px solid var(--border-light); box-shadow: 0 2px 8px rgba(139, 69, 19, 0.06); }
        .section-title { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--primary); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--accent-light); }
        .menu-day { margin-bottom: 1rem; }
        .menu-day:last-child { margin-bottom: 0; }
        .menu-day-header { font-weight: 600; color: var(--text-dark); font-size: 0.95rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .menu-day-header.disabled { color: var(--text-muted); opacity: 0.5; }
        .menu-day-header .day-badge { background: var(--primary); color: white; padding: 0.15rem 0.6rem; border-radius: 4px; font-size: 0.8rem; }
        .menu-day-header.disabled .day-badge { background: #BDBDBD; }
        .menu-items-list { background: var(--bg-warm); border-radius: 6px; padding: 0.5rem 0.75rem; }
        .menu-item-row { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0; font-size: 0.9rem; border-bottom: 1px solid var(--border-light); }
        .menu-item-row:last-child { border-bottom: none; }
        .menu-item-row.disabled { color: var(--text-muted); opacity: 0.5; }
        .menu-item-name { flex: 1; color: var(--text-medium); }
        .menu-item-price { color: var(--primary); font-weight: 600; margin-left: 1rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-size: 0.9rem; color: var(--text-medium); margin-bottom: 0.4rem; font-weight: 600; }
        .form-input { width: 100%; padding: 0.75rem; background: var(--bg-white); border: 1px solid var(--border-warm); border-radius: 8px; color: var(--text-dark); font-size: 1rem; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1); }
        .form-input::placeholder { color: var(--text-muted); }
        .form-input.error { border-color: var(--error); background: var(--error-bg); }
        .error-message { color: var(--error); font-size: 0.8rem; margin-top: 0.25rem; display: none; }
        .error-message.show { display: block; }
        .radio-group { display: flex; gap: 1rem; flex-wrap: wrap; }
        .radio-option { flex: 1; min-width: 120px; }
        .radio-option input { display: none; }
        .radio-option label { display: block; padding: 0.75rem; background: var(--bg-warm); border: 2px solid var(--border-warm); border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; color: var(--text-medium); }
        .radio-option input:checked + label { border-color: var(--primary); background: rgba(139, 69, 19, 0.08); color: var(--primary); font-weight: 600; }
        .radio-option label:hover { background: var(--accent-light); border-color: var(--accent); }
        .delivery-address-container { display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-light); }
        .delivery-address-container.show { display: block; }
        .delivery-note { font-size: 0.8rem; color: var(--warning); margin-top: 0.4rem; font-style: italic; }
        .day-order-section { background: var(--bg-warm); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border: 1px solid var(--border-light); }
        .day-order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .day-order-title { font-weight: 600; color: var(--text-dark); }
        .remove-day-btn { background: transparent; border: none; color: var(--error); cursor: pointer; padding: 0.25rem; font-size: 1.2rem; }
        .day-select { width: 100%; padding: 0.6rem; background: var(--bg-white); border: 1px solid var(--border-warm); border-radius: 6px; color: var(--text-dark); font-size: 0.95rem; margin-bottom: 0.75rem; }
        .day-select option:disabled { color: #BDBDBD; }
        .item-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap; }
        .item-select { flex: 1; min-width: 150px; padding: 0.5rem; background: var(--bg-white); border: 1px solid var(--border-warm); border-radius: 6px; color: var(--text-dark); font-size: 0.9rem; }
        .size-select { width: 100px; padding: 0.5rem; background: var(--bg-white); border: 1px solid var(--border-warm); border-radius: 6px; color: var(--text-dark); font-size: 0.9rem; }
        .qty-input { width: 60px; padding: 0.5rem; background: var(--bg-white); border: 1px solid var(--border-warm); border-radius: 6px; color: var(--text-dark); font-size: 0.9rem; text-align: center; }
        .remove-item-btn { background: transparent; border: none; color: var(--error); cursor: pointer; padding: 0.25rem 0.5rem; font-size: 1rem; }
        .add-item-btn { background: transparent; border: 1px dashed var(--border-warm); color: var(--text-muted); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.85rem; width: 100%; margin-top: 0.5rem; transition: all 0.2s; }
        .add-item-btn:hover { border-color: var(--primary); color: var(--primary); background: rgba(139, 69, 19, 0.05); }
        .add-day-btn { background: var(--bg-white); border: 2px solid var(--primary); color: var(--primary); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; width: 100%; transition: all 0.2s; }
        .add-day-btn:hover { background: var(--primary); color: white; }
        .summary-content { background: var(--bg-warm); border-radius: 8px; padding: 1rem; }
        .summary-line { display: flex; justify-content: space-between; padding: 0.4rem 0; font-size: 0.9rem; border-bottom: 1px solid var(--border-light); color: var(--text-medium); }
        .summary-line:last-child { border-bottom: none; }
        .summary-total { display: flex; justify-content: space-between; padding: 0.75rem 0 0; margin-top: 0.5rem; border-top: 2px solid var(--primary); font-size: 1.1rem; font-weight: 700; color: var(--primary); }
        .submit-btn { width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border: none; border-radius: 10px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin-top: 1rem; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3); }
        .submit-btn:disabled { background: #BDBDBD; cursor: not-allowed; transform: none; }
        .message { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: center; }
        .message.error { background: var(--error-bg); border: 1px solid var(--error); color: var(--error); }
        .message.success { background: var(--success-bg); border: 1px solid var(--success); color: var(--success); }
        .hidden { display: none !important; }
        .loading { text-align: center; padding: 3rem 1rem; }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--border-light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .confirmation-card { text-align: center; padding: 2rem 1rem; }
        .confirmation-icon { font-size: 3rem; margin-bottom: 1rem; }
        .confirmation-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--success); margin-bottom: 0.5rem; }
        .order-id { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1.5rem; }
        .receipt { background: var(--bg-warm); border-radius: 8px; padding: 1rem; text-align: left; font-size: 0.85rem; white-space: pre-wrap; margin-bottom: 1rem; border: 1px solid var(--border-light); color: var(--text-medium); }
        .new-order-btn { background: var(--primary); border: none; color: white; padding: 0.75rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; }
        .footer { text-align: center; padding: 1.5rem 1rem; color: var(--text-muted); font-size: 0.85rem; border-top: 1px solid var(--border-light); margin-top: 1rem; background: var(--bg-white); }
        @media (max-width: 480px) {
            .hero { padding: 1.25rem 1rem; }
            .logo-text { font-size: 1.8rem; }
            .container { padding: 0.75rem; }
            .section-card { padding: 1rem; }
            .radio-option { min-width: 100px; }
            .item-row { flex-direction: column; align-items: stretch; }
            .item-select { min-width: 100%; }
            .item-row-controls { display: flex; gap: 0.5rem; align-items: center; }
            .size-select, .qty-input { flex: 1; }
            .submit-btn { position: sticky; bottom: 1rem; z-index: 100; box-shadow: 0 -4px 12px rgba(0,0,0,0.1); }
        }
    </style>
</head>
<body>
    <header class="hero">
        <div class="logo-container">
            <div class="logo-text">Aruna's Kitchen</div>
            <div class="phone-number">üìû +1 248-877-9924</div>
        </div>
        <div class="week-header">
            <div class="week-label" id="weekLabel">Loading menu...</div>
            <div class="week-dates" id="weekDates"></div>
        </div>
    </header>
    <div class="cutoff-banner"><strong>‚è∞</strong> Orders must be placed by 8 PM for next day delivery/pickup</div>
    <main class="container">
        <div id="errorMessage" class="message error hidden"></div>
        <div id="successMessage" class="message success hidden"></div>
        <div id="loadingIndicator" class="loading"><div class="spinner"></div><p>Loading menu...</p></div>
        <div id="formContainer" class="hidden">
            <section class="section-card">
                <h2 class="section-title">This Week's Menu</h2>
                <div id="menuDisplay"></div>
            </section>
            <section class="section-card">
                <h2 class="section-title">Your Information</h2>
                <form id="orderForm">
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" id="customerName" class="form-input" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" id="customerPhone" class="form-input" placeholder="(555) 123-4567" required>
                        <div id="phoneError" class="error-message">Please enter a valid 10-digit phone number</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fulfillment Method *</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="fulfillment" id="fulfillmentPickup" value="Pickup" checked>
                                <label for="fulfillmentPickup">Pickup</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="fulfillment" id="fulfillmentDelivery" value="Delivery">
                                <label for="fulfillmentDelivery">Delivery (+$2)</label>
                            </div>
                        </div>
                        <div id="deliveryAddressContainer" class="delivery-address-container">
                            <label class="form-label">Delivery Address *</label>
                            <input type="text" id="deliveryAddress" class="form-input" placeholder="Enter your street address">
                            <div class="delivery-note">üìç Delivery available only within Travisso</div>
                        </div>
                    </div>
                </form>
            </section>
            <section class="section-card">
                <h2 class="section-title">Your Order</h2>
                <div id="daysContainer"></div>
                <button type="button" class="add-day-btn" onclick="addDay()">+ Add Another Day</button>
            </section>
            <section class="section-card">
                <h2 class="section-title">Order Summary</h2>
                <div id="summaryContent" class="summary-content">
                    <p style="color: var(--text-muted); text-align: center; padding: 1rem 0;">Add items to see your order summary</p>
                </div>
            </section>
            <button type="button" class="submit-btn" onclick="submitOrder()">Place Order</button>
        </div>
        <div id="confirmationContainer" class="hidden">
            <div class="section-card confirmation-card">
                <div class="confirmation-icon">‚úÖ</div>
                <h2 class="confirmation-title">Order Confirmed!</h2>
                <div class="order-id" id="confirmationOrderId"></div>
                <div class="receipt" id="confirmationReceipt"></div>
                <button class="new-order-btn" onclick="location.reload()">Place New Order</button>
            </div>
        </div>
    </main>
    <footer class="footer">üçΩÔ∏è Freshly cooked ‚Ä¢ Homestyle flavors<br>Thank you for ordering from Aruna's Kitchen!</footer>
    <script>
        const DELIVERY_FEE = 2.00;
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwYh75tkXBQXruob4AYquHl7fndxwam7gSK1MVR__ww2gEQKnOp1QHJ5eTuWr1yy7Sf/exec';
        let menuData = [], activeWeek = '', weekStartDate = null, weekEndDate = null, dayCounter = 0;
        const DAY_ORDER = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        
        function getCurrentDayInfo() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentDayIndex = (now.getDay() + 6) % 7;
            const cutoffDayIndex = currentHour >= 20 ? currentDayIndex + 1 : currentDayIndex;
            return { currentDayIndex, cutoffDayIndex, currentHour };
        }
        
        function isDayOrderable(dayName) {
            const { cutoffDayIndex } = getCurrentDayInfo();
            return DAY_ORDER.indexOf(dayName) > cutoffDayIndex;
        }
        
        function calculateWeekDates() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const monday = new Date(now); monday.setDate(now.getDate() + diff);
            const sunday = new Date(monday); sunday.setDate(monday.getDate() + 6);
            weekStartDate = monday; weekEndDate = sunday;
            const options = { month: 'short', day: 'numeric' };
            return `${monday.toLocaleDateString('en-US', options)} - ${sunday.toLocaleDateString('en-US', options)}`;
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('weekDates').textContent = calculateWeekDates();
            await loadMenu(); addDay(); setupEventListeners();
        });
        
        function setupEventListeners() {
            document.querySelectorAll('input[name="fulfillment"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const container = document.getElementById('deliveryAddressContainer');
                    const addressInput = document.getElementById('deliveryAddress');
                    if (this.value === 'Delivery') { container.classList.add('show'); addressInput.required = true; }
                    else { container.classList.remove('show'); addressInput.required = false; }
                    updateSummary();
                });
            });
            document.getElementById('customerPhone').addEventListener('input', validatePhone);
            document.getElementById('customerPhone').addEventListener('blur', formatPhone);
        }
        
        function validatePhone() {
            const phoneInput = document.getElementById('customerPhone');
            const phoneError = document.getElementById('phoneError');
            const digits = phoneInput.value.replace(/\D/g, '');
            if (digits.length === 10) { phoneInput.classList.remove('error'); phoneError.classList.remove('show'); return true; }
            else if (digits.length > 0) { phoneInput.classList.add('error'); phoneError.classList.add('show'); return false; }
            phoneInput.classList.remove('error'); phoneError.classList.remove('show'); return false;
        }
        
        function formatPhone() {
            const phoneInput = document.getElementById('customerPhone');
            const digits = phoneInput.value.replace(/\D/g, '');
            if (digits.length === 10) phoneInput.value = `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
        }
        
        async function loadMenu() {
            showLoading(true);
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getMenu`);
                const data = await response.json();
                if (data.error) { showError(data.error); return; }
                menuData = data.menu; activeWeek = data.weekLabel;
                document.getElementById('weekLabel').textContent = `Week of ${activeWeek}`;
                displayMenu(); showLoading(false);
                document.getElementById('formContainer').classList.remove('hidden');
            } catch (error) {
                menuData = getSampleMenu(); activeWeek = weekStartDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                document.getElementById('weekLabel').textContent = `Week of ${activeWeek}`;
                displayMenu(); showLoading(false);
                document.getElementById('formContainer').classList.remove('hidden');
            }
        }
        
        function getSampleMenu() {
            return [
                { day: 'Monday', item: 'Chicken Biryani', size: 'Regular (16oz)', price: 12.99 },
                { day: 'Monday', item: 'Chicken Biryani', size: 'Large (24oz)', price: 16.99 },
                { day: 'Monday', item: 'Veg Pulao', size: 'Regular (16oz)', price: 10.99 },
                { day: 'Tuesday', item: 'Butter Chicken', size: 'Regular (16oz)', price: 13.99 },
                { day: 'Tuesday', item: 'Butter Chicken', size: 'Large (24oz)', price: 17.99 },
                { day: 'Tuesday', item: 'Dal Makhani', size: 'Regular (16oz)', price: 9.99 },
                { day: 'Wednesday', item: 'Lamb Curry', size: 'Regular (16oz)', price: 14.99 },
                { day: 'Wednesday', item: 'Lamb Curry', size: 'Large (24oz)', price: 18.99 },
                { day: 'Wednesday', item: 'Paneer Tikka', size: 'Regular (16oz)', price: 11.99 },
                { day: 'Thursday', item: 'Fish Curry', size: 'Regular (16oz)', price: 13.99 },
                { day: 'Thursday', item: 'Fish Curry', size: 'Large (24oz)', price: 17.99 },
                { day: 'Thursday', item: 'Aloo Gobi', size: 'Regular (16oz)', price: 9.99 },
                { day: 'Friday', item: 'Chicken Tikka Masala', size: 'Regular (16oz)', price: 13.99 },
                { day: 'Friday', item: 'Chicken Tikka Masala', size: 'Large (24oz)', price: 17.99 },
                { day: 'Friday', item: 'Chana Masala', size: 'Regular (16oz)', price: 9.99 }
            ];
        }
        
        function displayMenu() {
            const container = document.getElementById('menuDisplay');
            const dayGroups = {};
            menuData.forEach(item => {
                if (!dayGroups[item.day]) dayGroups[item.day] = [];
                const existingItem = dayGroups[item.day].find(i => i.item === item.item);
                if (existingItem) existingItem.sizes.push({ size: item.size, price: item.price });
                else dayGroups[item.day].push({ item: item.item, sizes: [{ size: item.size, price: item.price }] });
            });
            let html = '';
            DAY_ORDER.forEach(day => {
                if (dayGroups[day]) {
                    const isOrderable = isDayOrderable(day);
                    const disabledClass = isOrderable ? '' : 'disabled';
                    html += `<div class="menu-day"><div class="menu-day-header ${disabledClass}"><span class="day-badge">${day}</span></div><div class="menu-items-list">`;
                    dayGroups[day].forEach(menuItem => {
                        const priceRange = menuItem.sizes.map(s => `$${s.price.toFixed(2)}`).join(' / ');
                        html += `<div class="menu-item-row ${disabledClass}"><span class="menu-item-name">${menuItem.item}</span><span class="menu-item-price">${priceRange}</span></div>`;
                    });
                    html += `</div></div>`;
                }
            });
            container.innerHTML = html;
        }
        
        function addDay() {
            dayCounter++;
            const container = document.getElementById('daysContainer');
            const dayId = `day-${dayCounter}`;
            const daySection = document.createElement('div');
            daySection.className = 'day-order-section'; daySection.id = dayId;
            let dayOptions = '<option value="">Select a day</option>';
            const availableDays = [...new Set(menuData.map(item => item.day))];
            DAY_ORDER.forEach(day => {
                if (availableDays.includes(day)) {
                    const isOrderable = isDayOrderable(day);
                    dayOptions += isOrderable ? `<option value="${day}">${day}</option>` : `<option value="${day}" disabled>${day} (unavailable)</option>`;
                }
            });
            daySection.innerHTML = `<div class="day-order-header"><span class="day-order-title">Order #${dayCounter}</span><button type="button" class="remove-day-btn" onclick="removeDay('${dayId}')" title="Remove">√ó</button></div><select class="day-select" onchange="onDayChange('${dayId}')">${dayOptions}</select><div class="items-container" id="items-${dayId}"></div><button type="button" class="add-item-btn" onclick="addItem('${dayId}')">+ Add Item</button>`;
            container.appendChild(daySection); addItem(dayId);
        }
        
        function onDayChange(dayId) {
            document.getElementById(`items-${dayId}`).innerHTML = '';
            addItem(dayId); updateSummary();
        }
        
        function addItem(dayId) {
            const section = document.getElementById(dayId);
            const selectedDay = section.querySelector('.day-select').value;
            const itemsContainer = document.getElementById(`items-${dayId}`);
            const itemId = `${dayId}-item-${Date.now()}`;
            let itemOptions = '<option value="">Select item</option>';
            if (selectedDay) {
                [...new Set(menuData.filter(m => m.day === selectedDay).map(m => m.item))].forEach(item => {
                    itemOptions += `<option value="${item}">${item}</option>`;
                });
            }
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row'; itemRow.id = itemId;
            itemRow.innerHTML = `<select class="item-select" onchange="onItemChange('${itemId}', '${dayId}')">${itemOptions}</select><div class="item-row-controls"><select class="size-select" onchange="updateSummary()"><option value="">Size</option></select><input type="number" class="qty-input" value="1" min="1" max="10" onchange="updateSummary()"><button type="button" class="remove-item-btn" onclick="removeItem('${itemId}')">√ó</button></div>`;
            itemsContainer.appendChild(itemRow);
        }
        
        function onItemChange(itemId, dayId) {
            const itemRow = document.getElementById(itemId);
            const selectedDay = document.getElementById(dayId).querySelector('.day-select').value;
            const selectedItem = itemRow.querySelector('.item-select').value;
            const sizeSelect = itemRow.querySelector('.size-select');
            let sizeOptions = '<option value="">Size</option>';
            if (selectedItem) {
                menuData.filter(m => m.day === selectedDay && m.item === selectedItem).forEach(s => {
                    sizeOptions += `<option value="${s.size}" data-price="${s.price}">${s.size} - $${s.price.toFixed(2)}</option>`;
                });
            }
            sizeSelect.innerHTML = sizeOptions; updateSummary();
        }
        
        function removeDay(dayId) { document.getElementById(dayId)?.remove(); updateSummary(); }
        function removeItem(itemId) { document.getElementById(itemId)?.remove(); updateSummary(); }
        
        function updateSummary() {
            const summaryContent = document.getElementById('summaryContent');
            let items = [], subtotal = 0;
            document.querySelectorAll('.day-order-section').forEach(section => {
                const day = section.querySelector('.day-select').value;
                if (!day) return;
                section.querySelectorAll('.item-row').forEach(row => {
                    const item = row.querySelector('.item-select')?.value;
                    const size = row.querySelector('.size-select')?.value;
                    const qty = parseInt(row.querySelector('.qty-input')?.value) || 1;
                    const price = parseFloat(row.querySelector('.size-select')?.selectedOptions[0]?.dataset.price) || 0;
                    if (item && size && price > 0) { subtotal += price * qty; items.push({ day, item, size, qty, price, lineTotal: price * qty }); }
                });
            });
            if (items.length === 0) { summaryContent.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 1rem 0;">Add items to see your order summary</p>'; return; }
            const isDelivery = document.querySelector('input[name="fulfillment"]:checked').value === 'Delivery';
            const deliveryFee = isDelivery ? DELIVERY_FEE : 0;
            let html = '';
            items.forEach(item => { html += `<div class="summary-line"><span>${item.day}: ${item.item} (${item.size}) x${item.qty}</span><span>$${item.lineTotal.toFixed(2)}</span></div>`; });
            if (isDelivery) html += `<div class="summary-line"><span>Delivery Fee</span><span>$${deliveryFee.toFixed(2)}</span></div>`;
            html += `<div class="summary-total"><span>Total</span><span>$${(subtotal + deliveryFee).toFixed(2)}</span></div>`;
            summaryContent.innerHTML = html;
        }
        
        async function submitOrder() {
            const phoneDigits = document.getElementById('customerPhone').value.replace(/\D/g, '');
            if (phoneDigits.length !== 10) { showError('Please enter a valid 10-digit phone number'); document.getElementById('customerPhone').focus(); return; }
            const name = document.getElementById('customerName').value.trim();
            if (!name) { showError('Please enter your name'); return; }
            const phone = document.getElementById('customerPhone').value.trim();
            const fulfillment = document.querySelector('input[name="fulfillment"]:checked').value;
            let deliveryAddress = '';
            if (fulfillment === 'Delivery') {
                deliveryAddress = document.getElementById('deliveryAddress').value.trim();
                if (!deliveryAddress) { showError('Please enter your delivery address'); document.getElementById('deliveryAddress').focus(); return; }
            }
            const orderItems = [];
            document.querySelectorAll('.day-order-section').forEach(section => {
                const day = section.querySelector('.day-select').value;
                if (!day) return;
                section.querySelectorAll('.item-row').forEach(row => {
                    const item = row.querySelector('.item-select')?.value;
                    const size = row.querySelector('.size-select')?.value;
                    const qty = parseInt(row.querySelector('.qty-input')?.value) || 1;
                    const price = parseFloat(row.querySelector('.size-select')?.selectedOptions[0]?.dataset.price) || 0;
                    if (item && size && price > 0) orderItems.push({ day, item, size, qty, price });
                });
            });
            if (orderItems.length === 0) { showError('Please add at least one item to your order'); return; }
            const subtotal = orderItems.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const deliveryFee = fulfillment === 'Delivery' ? DELIVERY_FEE : 0;
            const orderData = { name, phone, fulfillment, deliveryAddress, items: orderItems, subtotal, deliveryFee, total: subtotal + deliveryFee, week: activeWeek };
            showLoading(true); document.getElementById('formContainer').classList.add('hidden');
            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: 'submitOrder', order: orderData }) });
                showConfirmation(orderData, 'ORD-' + Date.now().toString().slice(-8));
            } catch (error) { showConfirmation(orderData, 'DEMO-' + Date.now().toString().slice(-6)); }
        }
        
        function showConfirmation(order, orderId) {
            showLoading(false);
            document.getElementById('confirmationOrderId').textContent = `Order ID: ${orderId}`;
            let receipt = `ARUNA'S KITCHEN\nOrder Confirmation\n${'‚îÄ'.repeat(30)}\n\nCustomer: ${order.name}\nPhone: ${order.phone}\nMethod: ${order.fulfillment}\n`;
            if (order.deliveryAddress) receipt += `Address: ${order.deliveryAddress}\n`;
            receipt += `\n${'‚îÄ'.repeat(30)}\nITEMS:\n`;
            order.items.forEach(item => { receipt += `\n${item.day}\n  ${item.item}\n  ${item.size} x${item.qty} = $${(item.price * item.qty).toFixed(2)}\n`; });
            receipt += `\n${'‚îÄ'.repeat(30)}\nSubtotal: $${order.subtotal.toFixed(2)}\n`;
            if (order.deliveryFee > 0) receipt += `Delivery: $${order.deliveryFee.toFixed(2)}\n`;
            receipt += `TOTAL: $${order.total.toFixed(2)}\n${'‚îÄ'.repeat(30)}\n\nThank you for your order!`;
            document.getElementById('confirmationReceipt').textContent = receipt;
            document.getElementById('confirmationContainer').classList.remove('hidden');
        }
        
        function showLoading(show) { document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none'; }
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message; errorDiv.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }
    </script>
</body>
</html>
